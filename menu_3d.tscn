[gd_scene load_steps=13 format=3 uid="uid://b3sm04uvddntk"]

[ext_resource type="Script" uid="uid://d1poeuys62j7p" path="res://info.gd" id="1_p1njt"]
[ext_resource type="Script" uid="uid://dhk4xfpjryuw" path="res://Scene/startbutton.gd" id="1_utbun"]
[ext_resource type="Shader" uid="uid://bvuiaksih76tx" path="res://sky.gdshader" id="1_x8tam"]
[ext_resource type="Texture2D" uid="uid://bkpmbxw2cnho2" path="res://icon.svg" id="2_no0f4"]
[ext_resource type="PackedScene" uid="uid://5ocgbdw0tyba" path="res://3d/bolo.glb" id="4_no0f4"]
[ext_resource type="FontFile" uid="uid://bajivabu2xdd8" path="res://Font/SpaceMono-Regular.ttf" id="4_p1njt"]

[sub_resource type="ShaderMaterial" id="ShaderMaterial_p1njt"]
shader = ExtResource("1_x8tam")
shader_parameter/sky_color = Color(0.3620822, 0.5426541, 0.77224743, 1)
shader_parameter/cloud_color = Color(0.8237062, 0.8253291, 0.88099855, 1)
shader_parameter/lightning_color = Color(1, 1, 1, 1)
shader_parameter/storm_density = 0.8
shader_parameter/lightning_intensity = 0.5

[sub_resource type="Sky" id="Sky_j5tum"]
sky_material = SubResource("ShaderMaterial_p1njt")

[sub_resource type="Environment" id="Environment_nb3gs"]
background_mode = 2
sky = SubResource("Sky_j5tum")
fog_density = 0.5261

[sub_resource type="ViewportTexture" id="ViewportTexture_6fhkg"]
viewport_path = NodePath("Sprite3D/SubViewport")

[sub_resource type="Shader" id="Shader_cenux"]
code = "shader_type canvas_item;

// Cores ajustadas para serem menos escuras, mas ainda climáticas
uniform vec4 cor_ceu : source_color = vec4(0.05, 0.1, 0.2, 1.0);
uniform vec4 cor_nuvem : source_color = vec4(0.3, 0.3, 0.35, 1.0);
uniform vec4 cor_raio : source_color = vec4(0.9, 0.95, 1.0, 1.0);

uniform float velocidade : hint_range(0.0, 2.0) = 0.08;
uniform float densidade : hint_range(0.0, 2.0) = 0.45;

float rand(vec2 uv) {
    return fract(sin(dot(uv, vec2(12.9898, 78.233))) * 43758.5453);
}

float noise(vec2 uv) {
    vec2 i = floor(uv);
    vec2 f = fract(uv);
    float a = rand(i);
    float b = rand(i + vec2(1.0, 0.0));
    float c = rand(i + vec2(0.0, 1.0));
    float d = rand(i + vec2(1.0, 1.0));
    vec2 u = f * f * (3.0 - 2.0 * f);
    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
}

float fbm(vec2 uv) {
    float valor = 0.0;
    float amplitude = 0.5;
    for (int i = 0; i < 7; i++) {
        valor += amplitude * noise(uv);
        uv *= 2.15;
        amplitude *= 0.5;
    }
    return valor;
}

void fragment() {
    // Distorção orgânica para movimento flúido
    vec2 uv_distorcido = UV * 3.0;
    uv_distorcido += fbm(uv_distorcido * 0.4 + TIME * 0.04) * 0.25;

    vec2 movimento = vec2(TIME * velocidade, TIME * velocidade * 0.15);
    float n = fbm(uv_distorcido + movimento);

    // Suavização da nuvem com mais contraste
    float nuvem_final = smoothstep(densidade, densidade + 0.45, n);

    // Lógica de Raios Intensificada
    // Aumentamos a velocidade do tempo do raio para checagens mais rápidas
    float tempo_raio = TIME * 1.5;

    // Criamos dois triggers diferentes para raios duplos ou mais frequentes
    float trigger1 = step(0.96, fract(sin(floor(tempo_raio) * 532.12)));
    float trigger2 = step(0.98, fract(sin(floor(tempo_raio * 0.5) * 891.32)));
    float flash_trigger = clamp(trigger1 + trigger2, 0.0, 1.0);

    // Decaimento do flash: brilha e desvanece de forma orgânica
    float flash_intensidade = flash_trigger * pow(1.0 - fract(tempo_raio), 2.5) * 2.5;

    // Mistura das cores base
    vec4 cor_base = mix(cor_ceu, cor_nuvem, nuvem_final);

    // O raio ilumina as nuvens intensamente
    vec4 final_color = mix(cor_base, cor_raio, flash_intensidade * nuvem_final * 0.9);

    // Brilho atmosférico global durante o raio
    final_color += cor_raio * flash_intensidade * 0.4;

    COLOR = vec4(final_color.rgb, 1.0);
}"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_rgox8"]
shader = SubResource("Shader_cenux")
shader_parameter/cor_ceu = Color(0.3, 0.5, 0.9, 1)
shader_parameter/cor_nuvem = Color(1, 1, 1, 1)
shader_parameter/cor_raio = Color(1, 0.9, 0.7, 1)
shader_parameter/velocidade = 0.1
shader_parameter/densidade = 0.5

[node name="Node3D" type="Node3D"]

[node name="Control" type="Control" parent="."]
layout_mode = 3
anchors_preset = 0
offset_right = 1144.0
offset_bottom = 648.0
script = ExtResource("1_p1njt")

[node name="RichTextLabel" type="RichTextLabel" parent="Control"]
layout_mode = 0
offset_left = 591.0
offset_top = 205.0
offset_right = 1152.0
offset_bottom = 620.0
theme_override_fonts/normal_font = ExtResource("4_p1njt")

[node name="HTTPRequest" type="HTTPRequest" parent="Control"]

[node name="Camera3D" type="Camera3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1.6328632)
current = true

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_nb3gs")

[node name="bolo" parent="." instance=ExtResource("4_no0f4")]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0.8503295, -0.7437276, -0.026075363)

[node name="Sprite3D" type="Sprite3D" parent="."]
visible = false
texture = SubResource("ViewportTexture_6fhkg")

[node name="SubViewport" type="SubViewport" parent="Sprite3D"]
size = Vector2i(512, 300)

[node name="Sprite2D" type="Sprite2D" parent="Sprite3D/SubViewport"]
material = SubResource("ShaderMaterial_rgox8")
position = Vector2(587.5, 292)
scale = Vector2(10.1796875, 5.5625)
texture = ExtResource("2_no0f4")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1.727976)
light_energy = 0.175
light_angular_distance = 51.96
light_bake_mode = 1
shadow_enabled = true
shadow_bias = 0.0
sky_mode = 1

[node name="VBoxContainer" type="VBoxContainer" parent="."]
offset_left = 40.0
offset_top = 171.0
offset_right = 459.0
offset_bottom = 419.0

[node name="Button" type="Button" parent="VBoxContainer"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_p1njt")
theme_override_font_sizes/font_size = 48
text = "(F) Prosseguir"
script = ExtResource("1_utbun")

[node name="Menu" type="Button" parent="VBoxContainer"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_p1njt")
theme_override_font_sizes/font_size = 48
text = "Menu"

[node name="Sobre" type="Button" parent="VBoxContainer"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_p1njt")
theme_override_font_sizes/font_size = 48
text = "Sobre"

[connection signal="request_completed" from="Control/HTTPRequest" to="Control" method="_on_http_request_request_completed"]
